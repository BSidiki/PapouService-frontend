<section class="hero-carousel">
  <app-annonces-public></app-annonces-public>
</section>

<div class="filter-bar">
  <mat-form-field appearance="fill" class="filter">
    <mat-label>Filtrer par type</mat-label>
    <mat-select [(ngModel)]="filter" (selectionChange)="applyFilter()">
      <mat-option value="ALL">Tous</mat-option>
      <mat-option value="DEPOT">DÃ©pÃ´ts</mat-option>
      <mat-option value="RETRAIT">Retraits</mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="fill" class="filter">
    <mat-label>Filtrer par statut</mat-label>
    <mat-select [(ngModel)]="statusFilter" (selectionChange)="applyFilter()">
      <mat-option value="ALL">Tous</mat-option>
      <mat-option value="PENDING">En attente</mat-option>
      <mat-option value="VALIDATED">ValidÃ©</mat-option>
      <mat-option value="REJECTED">RejetÃ©</mat-option>
    </mat-select>
  </mat-form-field>
</div>

<!-- Ã©tats -->
<div *ngIf="loading" class="loading">Chargementâ€¦</div>
<div *ngIf="!loading && errorMsg" class="error">{{ errorMsg }}</div>
<div *ngIf="!loading && !errorMsg && filteredHistoriques.length === 0" class="no-result">
  Aucune transaction trouvÃ©e.
</div>

<div class="transaction-list" *ngIf="!loading && !errorMsg">
  <mat-card
    *ngFor="let item of filteredHistoriques"
    class="transaction-card"
    (click)="goToDetails(item)"
    [ngClass]="{ 'depot-card': item.transaction === 'DEPOT', 'retrait-card': item.transaction === 'RETRAIT' }"
  >
    <div class="contenu">
      <div class="transaction-header">
        <span class="icon">{{ item.transaction === 'DEPOT' ? 'ğŸ’¸' : 'ğŸ’¼' }}</span>
        <strong>{{ item.transaction }}</strong>
      </div>

      <div><strong>ID-TRANSACTION :</strong> N{{ item.id_transaction }}PS</div>
      <div><strong>Montant :</strong> {{ item.details?.montant ?? '---' }} FCFA</div>
      <div><strong>NumÃ©ro :</strong> {{ item.details?.numeroEnvoyant ?? '---' }}</div>
      <div *ngIf="item.date">
        <strong>Date :</strong> {{ item.date | date: 'dd/MM/yyyy - HH:mm' }}
      </div>
      <div>
        <strong>Statut :</strong>
        <span
          [ngClass]="{
            badge: true,
            pending: item.statut === 'PENDING',
            validated: item.statut === 'VALIDATED',
            rejected: item.statut === 'REJECTED'
          }"
        >
          {{
            item.statut === 'PENDING'
              ? 'En attente'
              : item.statut === 'VALIDATED'
              ? 'ValidÃ©'
              : item.statut === 'REJECTED'
              ? 'RejetÃ©'
              : 'Inconnu'
          }}
        </span>
      </div>

      <div class="link-text">ğŸ“‚ Voir les dÃ©tails</div>
    </div>
  </mat-card>
</div>
