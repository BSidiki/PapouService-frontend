<section class="hero-carousel">
  <app-annonces-public></app-annonces-public>
</section>

<div class="depot-page">
  <div class="depot-container">
    <!-- En-tête -->
    <div class="depot-header">
      <h1 class="main-title">
        <mat-icon class="title-icon">payments</mat-icon>
        Faire un Dépôt
      </h1>
      <p class="subtitle">Remplissez le formulaire ci-dessous pour effectuer votre dépôt</p>
    </div>

    <div class="depot-content">
      <!-- Formulaire de dépôt -->
      <mat-card class="depot-form-card">
        <div class="card-header">
          <mat-icon class="card-icon">account_balance_wallet</mat-icon>
          <h2>Formulaire de Dépôt</h2>
        </div>

        <form (ngSubmit)="submitDepot()" class="depot-form">
          <!-- Message d'alerte si pas d'IDs plateforme -->
          <div *ngIf="transactionOptionsDisponibles.length === 0" class="alert-message">
            <mat-icon>warning</mat-icon>
            <div class="alert-content">
              <h3>Aucun ID de plateforme configuré</h3>
              <p>Veuillez configurer vos identifiants de plateforme dans votre profil avant de faire un dépôt.</p>
              <button mat-stroked-button routerLink="/profil" class="profile-btn">
                <mat-icon>person</mat-icon>
                Aller au profil
              </button>
            </div>
          </div>

          <!-- Informations utilisateur -->
          <div *ngIf="userInfo" class="user-info">
            <mat-icon>person</mat-icon>
            <span>Connecté en tant que : <strong>{{ userInfo }}</strong></span>
          </div>

          <!-- Grille des champs -->
          <div class="form-grid">
            <!-- Pays -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Pays</mat-label>
              <mat-select [(ngModel)]="form.pays" name="pays" (selectionChange)="onPaysChange()" required>
                <mat-option *ngFor="let pays of paysOptions" [value]="pays.nom">
                  {{ pays.nom }}
                </mat-option>
              </mat-select>
              <mat-icon matPrefix>public</mat-icon>
            </mat-form-field>

            <!-- Numéro de téléphone -->
            <div class="phone-group">
              <mat-form-field appearance="outline" class="indicatif-field">
                <mat-label>Indicatif</mat-label>
                <input matInput [value]="form.indicatif" disabled />
                <mat-icon matPrefix>phone</mat-icon>
              </mat-form-field>

              <mat-form-field appearance="outline" class="numero-field">
                <mat-label>Numéro de téléphone</mat-label>
                <input matInput [(ngModel)]="form.numero" name="numero" required
                       placeholder="Ex: 70123456" />
              </mat-form-field>
            </div>

            <!-- Montant -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Montant (FCFA)</mat-label>
              <input matInput type="number" [(ngModel)]="form.montant" name="montant"
                     min="1" required placeholder="Ex: 5000" />
              <mat-icon matPrefix>attach_money</mat-icon>
              <mat-hint>Montant minimum : 1 FCFA</mat-hint>
            </mat-form-field>

            <!-- Plateforme -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Plateforme de jeu</mat-label>
              <mat-select [(ngModel)]="form.optionDeTransaction" name="optionDeTransaction" required>
                <mat-option *ngFor="let opt of transactionOptionsDisponibles" [value]="opt.value">
                  <div class="platform-option">
                    <img [src]="getPlatformLogo(opt.label)" [alt]="opt.label" class="platform-logo" />
                    <span>{{ opt.label }}</span>
                  </div>
                </mat-option>
              </mat-select>
              <mat-icon matPrefix>casino</mat-icon>
            </mat-form-field>

            <!-- Option de dépôt -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Moyen de paiement</mat-label>
              <mat-select [(ngModel)]="form.optionDepot" name="optionDepot" required>
                <mat-option value="O">
                  <div class="payment-option">
                    <img src="assets/images/OrangeMoney.png" alt="OrangeMoney" loading="lazy" style="width: 50px;" />
                    <!-- <mat-icon>account_balance_wallet</mat-icon> -->
                    <span>Orange Money </span>
                  </div>
                </mat-option>
                <mat-option value="M">
                  <div class="payment-option">
                    <img src="assets/images/MoovMoney.png" alt="MoovMoney" loading="lazy" style="width: 50px;" />
                    <!-- <mat-icon>account_balance_wallet</mat-icon> -->
                    <span>Moov Money</span>
                  </div>
                </mat-option>
                <mat-option value="W">
                  <div class="payment-option">
                    <img src="assets/images/WaveMoney.png" alt="WaveMoney" loading="lazy" style="width: 50px;" />
                    <!-- <mat-icon>account_balance_wallet</mat-icon> -->
                    <span>Wave</span>
                  </div>
                </mat-option>
                <mat-option value="S">
                  <div class="payment-option">
                    <img src="assets/images/SankMoney.png" alt="SankMoney" loading="lazy" style="width: 50px;" />
                    <!-- <mat-icon>account_balance_wallet</mat-icon> -->
                    <span>Sank Money</span>
                  </div>
                </mat-option>
                <mat-option value="C">
                  <div class="payment-option">
                    <img src="assets/images/CarteBancaire.png" alt="CarteBancaire" loading="lazy" style="width: 50px;" />
                    <!-- <mat-icon>credit_card</mat-icon> -->
                    <span>Carte Bancaire</span>
                  </div>
                </mat-option>
              </mat-select>
              <mat-icon matPrefix>payment</mat-icon>
            </mat-form-field>
          </div>

          <!-- Actions USSD/Apps -->
          <div *ngIf="form.optionDepot" class="payment-actions">
            <div *ngIf="form.optionDepot === 'O' || form.optionDepot === 'M'" class="ussd-action">
              <div class="action-header">
                <mat-icon>smartphone</mat-icon>
                <h4>Code USSD pour {{ getOptionDepotText(form.optionDepot) }}</h4>
              </div>
              <p>Cliquez pour lancer le code USSD sur mobile ou le copier sur desktop</p>
              <button mat-raised-button color="accent" type="button" (click)="ouvrirTelephone()"
                      class="action-btn" [disabled]="!form.montant || !form.optionDeTransaction">
                <mat-icon>send</mat-icon>
                {{ isMobile() ? 'Lancer le code' : 'Copier le code' }}
              </button>
              <p class="action-hint">➕ Validez avec votre <strong>code PIN</strong> après avoir lancé le code</p>
            </div>

            <div *ngIf="form.optionDepot === 'W'" class="app-action">
              <div class="action-header">
                <mat-icon>rocket_launch</mat-icon>
                <h4>Ouvrir l'application Wave</h4>
              </div>
              <button mat-raised-button color="accent" type="button" (click)="ouvrirWave()"
                      class="action-btn">
                <mat-icon>launch</mat-icon>
                Ouvrir Wave
              </button>
            </div>

            <div *ngIf="form.optionDepot === 'S'" class="app-action">
              <div class="action-header">
                <mat-icon>rocket_launch</mat-icon>
                <h4>Ouvrir l'application Sank Money</h4>
              </div>
              <button mat-raised-button color="accent" type="button" (click)="ouvrirSankMoney()"
                      class="action-btn">
                <mat-icon>launch</mat-icon>
                Ouvrir Sank Money
              </button>
            </div>
          </div>

          <!-- Upload de fichier -->
          <div class="file-upload-section">
            <h4 class="section-title">
              <mat-icon>image</mat-icon>
              Capture de la transaction
            </h4>

            <div class="file-upload-zone" [class.has-file]="filePreview">
              <input id="file" type="file" accept="image/*" (change)="onFileSelected($event)"
                     class="file-input" required />
              <label for="file" class="file-label">
                <mat-icon class="upload-icon">cloud_upload</mat-icon>
                <span class="upload-text">
                  {{ filePreview ? 'Changer la capture' : 'Choisir une capture' }}
                </span>
                <span class="upload-hint">PNG, JPG - Max 5 Mo</span>
              </label>

              <div *ngIf="filePreview" class="file-preview">
                <img [src]="filePreview" alt="Aperçu capture" class="preview-image" />
                <button type="button" mat-icon-button class="remove-btn" (click)="file = null; filePreview = null;">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
            </div>
          </div>

          <!-- Bouton de soumission -->
          <button mat-raised-button color="primary" type="submit"
                  [disabled]="isSubmitDisabled() || submitting" class="submit-btn">
            <div class="button-content">
              <mat-progress-spinner *ngIf="submitting" diameter="20"
                                    mode="indeterminate" color="accent" class="spinner">
              </mat-progress-spinner>
              <mat-icon *ngIf="!submitting" class="btn-icon">send</mat-icon>
              <span class="btn-text">
                {{ submitting ? 'Soumission en cours...' : 'Soumettre le dépôt' }}
              </span>
            </div>
          </button>
        </form>
      </mat-card>

      <!-- Section matchs -->
      <div class="matchs-section">
        <app-matchs></app-matchs>
      </div>
    </div>
  </div>
</div>

<app-footer></app-footer>
