<div class="password-page">
  <mat-card class="password-card">
    <div class="card-header">
      <a class="logo" routerLink="/accueil" aria-label="Retour Ã  l'accueil">
        <img
          src="assets/images/logo.png"
          alt="PapouService Logo"
          class="logo-img"
        />
        <span class="logo-text">PapouService</span>
      </a>
      <h1 class="title">ðŸ”’ Changer mon mot de passe</h1>
      <p class="subtitle">
        Pour votre sÃ©curitÃ©, choisissez un mot de passe fort et unique.
      </p>
    </div>

    <form #passwordForm="ngForm" (ngSubmit)="onSubmit(passwordForm)" novalidate>
      <!-- Ancien mot de passe -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Ancien mot de passe</mat-label>
        <input
          matInput
          [type]="showOld ? 'text' : 'password'"
          [(ngModel)]="form.ancienMotDePasse"
          name="ancienMotDePasse"
          required
          minlength="4"
          autocomplete="current-password"
        />
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="showOld = !showOld"
          [attr.aria-label]="showOld ? 'Masquer le mot de passe' : 'Afficher le mot de passe'"
        >
          <mat-icon>{{ showOld ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error *ngIf="passwordForm.submitted && passwordForm.controls['ancienMotDePasse']?.invalid">
          L'ancien mot de passe est obligatoire.
        </mat-error>
      </mat-form-field>

      <!-- Nouveau mot de passe -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Nouveau mot de passe</mat-label>
        <input
          matInput
          [type]="showNew ? 'text' : 'password'"
          [(ngModel)]="form.nouveauMotDePasse"
          name="nouveauMotDePasse"
          required
          minlength="6"
          autocomplete="new-password"
        />
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="showNew = !showNew"
          [attr.aria-label]="showNew ? 'Masquer le mot de passe' : 'Afficher le mot de passe'"
        >
          <mat-icon>{{ showNew ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error *ngIf="passwordForm.submitted && passwordForm.controls['nouveauMotDePasse']?.errors?.['required']">
          Le nouveau mot de passe est obligatoire.
        </mat-error>
        <mat-error *ngIf="passwordForm.submitted && passwordForm.controls['nouveauMotDePasse']?.errors?.['minlength']">
          Le nouveau mot de passe doit contenir au moins 6 caractÃ¨res.
        </mat-error>
      </mat-form-field>

      <!-- Confirmation -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Confirmer le mot de passe</mat-label>
        <input
          matInput
          [type]="showConfirm ? 'text' : 'password'"
          [(ngModel)]="form.confirmation"
          name="confirmation"
          required
          minlength="6"
          autocomplete="new-password"
        />
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="showConfirm = !showConfirm"
          [attr.aria-label]="showConfirm ? 'Masquer le mot de passe' : 'Afficher le mot de passe'"
        >
          <mat-icon>{{ showConfirm ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error *ngIf="passwordForm.submitted && passwordForm.controls['confirmation']?.errors?.['required']">
          La confirmation du mot de passe est obligatoire.
        </mat-error>
      </mat-form-field>

      <div class="password-hints">
        <p>âœ… Conseils :</p>
        <ul>
          <li>Au moins 6 caractÃ¨res</li>
          <li>Combiner lettres, chiffres et symboles</li>
          <li>Ã‰viter les informations faciles Ã  deviner</li>
        </ul>
      </div>

      <button
        mat-raised-button
        color="primary"
        class="submit-btn"
        type="submit"
        [disabled]="passwordForm.invalid || isSubmitting"
      >
        <mat-icon *ngIf="!isSubmitting">lock_reset</mat-icon>
        <span *ngIf="!isSubmitting">Mettre Ã  jour</span>
        <span *ngIf="isSubmitting">Traitement en cours...</span>
      </button>
    </form>

    <div class="feedback-wrapper" *ngIf="hasFeedback">
      <p class="feedback success" *ngIf="message">
        <mat-icon>check_circle</mat-icon>
        <span>{{ message }}</span>
      </p>
      <p class="feedback error" *ngIf="error">
        <mat-icon>error</mat-icon>
        <span>{{ error }}</span>
      </p>
    </div>
  </mat-card>
</div>
