<div class="historique-container">
  <div class="top-bar">
    <button mat-stroked-button (click)="goBack()" class="back-button">
      <span class="back-icon">â†</span>
      Retour
    </button>

    <div class="header-section">
      <h2 class="header-title">
        Historique du client
      </h2>
      <div class="logo" routerLink="/accueil" matTooltip="Accueil">
        <img src="assets/images/logo.png" alt="PapouService Logo" class="logo-img" />
      </div>
    </div>
  </div>

  <!-- Filtres -->
  <div class="filter-bar">
    <mat-form-field appearance="outline" class="filter-select">
      <mat-label>Filtrer par type</mat-label>
      <mat-select [(ngModel)]="filterType" (selectionChange)="applyFilter()">
        <mat-option value="ALL">Tous</mat-option>
        <mat-option value="DEPOT">DÃ©pÃ´ts</mat-option>
        <mat-option value="RETRAIT">Retraits</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="filter-select">
      <mat-label>Filtrer par statut</mat-label>
      <mat-select [(ngModel)]="statusFilter" (selectionChange)="applyFilter()">
        <mat-option value="ALL">Tous</mat-option>
        <mat-option value="PENDING">En attente</mat-option>
        <mat-option value="VALIDATED">ValidÃ©</mat-option>
        <mat-option value="REJECTED">RejetÃ©</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <!-- Statistiques rapides -->
  <div class="stats-container">
    <div class="stat-card">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-info">
        <div class="stat-value">{{totalTransactions}}</div>
        <div class="stat-label">Total transactions</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ’¸</div>
      <div class="stat-info">
        <div class="stat-value">{{depotsCount}}</div>
        <div class="stat-label">DÃ©pÃ´ts</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ’¼</div>
      <div class="stat-info">
        <div class="stat-value">{{retraitsCount}}</div>
        <div class="stat-label">Retraits</div>
      </div>
    </div>
  </div>

  <!-- Aucun rÃ©sultat -->
  <div *ngIf="filtered.length === 0" class="no-result">
    <div class="no-result-icon">ğŸ”</div>
    <h3>Aucun rÃ©sultat trouvÃ©</h3>
    <p>Aucune transaction ne correspond Ã  vos critÃ¨res de filtrage.</p>
  </div>

  <!-- Liste des transactions -->
  <div class="transaction-list" *ngIf="filtered.length > 0">
    <mat-card
      *ngFor="let item of filtered"
      class="transaction-card"
      (click)="voirDetails(item)"
      [ngClass]="{
        'depot-card': item.transaction === 'DEPOT',
        'retrait-card': item.transaction === 'RETRAIT'
      }"
    >
      <div class="card-header">
        <div class="transaction-type">
          <span class="type-icon">
            {{ getTransactionIcon(item.transaction) }}
          </span>
          <span class="type-text">{{ item.transaction }}</span>
        </div>
        <div class="transaction-id">N{{ item.id_transaction }}PS</div>
      </div>

      <div class="card-content">
        <div class="info-row">
          <span class="info-label">Montant :</span>
          <span class="info-value">{{ item.details?.montant || '---' }} FCFA</span>
        </div>

        <div class="info-row">
          <span class="info-label">NumÃ©ro :</span>
          <span class="info-value">{{ item.details?.numeroEnvoyant || '---' }}</span>
        </div>

        <div class="info-row" *ngIf="item.date">
          <span class="info-label">Date :</span>
          <span class="info-value">{{ item.date | date: 'dd/MM/yyyy - HH:mm' }}</span>
        </div>

        <div class="info-row">
          <span class="info-label">Statut :</span>
          <span [ngClass]="{
            'status-badge': true,
            'pending': item.statut === 'PENDING',
            'validated': item.statut === 'VALIDATED',
            'rejected': item.statut === 'REJECTED'
          }">
            {{ getStatusText(item.statut) }}
          </span>
        </div>
      </div>

      <div class="card-footer">
        <span class="details-link">
          Voir les dÃ©tails
          <span class="link-arrow">â†’</span>
        </span>
      </div>
    </mat-card>
  </div>
</div>
